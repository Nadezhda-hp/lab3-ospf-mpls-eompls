# ============================================================
# ContainerLab топология для Лабораторной работы №3
# "Эмуляция распределённой корпоративной сети связи,
#  настройка OSPF и MPLS, организация первого EoMPLS"
# ============================================================
#
# Компания "RogalKopita Games" приобрела студию в Нью-Йорке.
# Нужно подключить Нью-Йоркский офис к общей IP/MPLS сети
# и организовать EoMPLS между "SGI Prism" (Нью-Йорк)
# и ПК инженеров в Санкт-Петербурге.
#
# Схема сети:
#
# SGI Prism --- R01.NY --- R01.LND --- R01.HKI --- R01.SPB --- PC1
#                              |                       |
#                          R01.LBN --------------- R01.MSK
#
# Два пути между NY и SPB обеспечивают отказоустойчивость:
#   Путь 1: NY → LND → HKI → SPB
#   Путь 2: NY → LND → LBN → MSK → SPB
#
# EoMPLS-туннель: R01.NY <=====> R01.SPB
#   (соединяет SGI Prism и PC1 на уровне L2)
# ============================================================

name: lab3

topology:
  nodes:
    # === РОУТЕРЫ (MikroTik RouterOS CHR) ===

    # Роутер в Нью-Йорке — точка подключения SGI Prism
    R01.NY:
      kind: vr-ros
      image: vrnetlab/vr-ros:6.47.9
      startup-config: R01_NY.rsc

    # Роутер в Лондоне — транзитный узел
    R01.LND:
      kind: vr-ros
      image: vrnetlab/vr-ros:6.47.9
      startup-config: R01_LND.rsc

    # Роутер в Любляне — транзитный узел (нижний путь)
    R01.LBN:
      kind: vr-ros
      image: vrnetlab/vr-ros:6.47.9
      startup-config: R01_LBN.rsc

    # Роутер в Хельсинки — транзитный узел (верхний путь)
    R01.HKI:
      kind: vr-ros
      image: vrnetlab/vr-ros:6.47.9
      startup-config: R01_HKI.rsc

    # Роутер в Москве — транзитный узел (нижний путь)
    R01.MSK:
      kind: vr-ros
      image: vrnetlab/vr-ros:6.47.9
      startup-config: R01_MSK.rsc

    # Роутер в Санкт-Петербурге — точка подключения PC1
    R01.SPB:
      kind: vr-ros
      image: vrnetlab/vr-ros:6.47.9
      startup-config: R01_SPB.rsc

    # === КОНЕЧНЫЕ УСТРОЙСТВА ===

    # Сервер SGI Prism в Нью-Йоркском офисе (обычный Linux-контейнер)
    SGI_Prism:
      kind: linux
      image: alpine:latest
      exec:
        - ip link set eth1 up
        - ip addr add 10.10.20.1/24 dev eth1

    # ПК инженера в Санкт-Петербурге
    PC1:
      kind: linux
      image: alpine:latest
      exec:
        - ip link set eth1 up
        - ip addr add 10.10.20.2/24 dev eth1

  # === СОЕДИНЕНИЯ ===
  links:
    # --- Магистральные каналы между роутерами ---
    # Верхний путь: NY → LND → HKI → SPB
    - endpoints: ["R01.NY:eth1", "R01.LND:eth1"]
    - endpoints: ["R01.LND:eth2", "R01.HKI:eth1"]
    - endpoints: ["R01.HKI:eth2", "R01.SPB:eth1"]

    # Нижний путь: LND → LBN → MSK → SPB
    - endpoints: ["R01.LND:eth3", "R01.LBN:eth1"]
    - endpoints: ["R01.LBN:eth2", "R01.MSK:eth1"]
    - endpoints: ["R01.MSK:eth2", "R01.SPB:eth2"]

    # --- Подключение конечных устройств ---
    - endpoints: ["R01.NY:eth2", "SGI_Prism:eth1"]
    - endpoints: ["R01.SPB:eth3", "PC1:eth1"]
